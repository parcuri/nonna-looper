<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tuttofisa – All Uploads (Player + List)</title>
  <style>
    :root {
      --bg: #0b0b0b;
      --fg: #ffffff;
      --muted: #c7c7c7;
      --accent: #ffd54f;
    }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--fg); }
    body { font: 18px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    header { padding: 12px 16px; text-align: center; font-weight: 600; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 0 12px 24px; }
    /* 16:9 responsive player */
    #player-container { position: relative; width: 100%; padding-bottom: 56.25%; height: 0; border-radius: 12px; overflow: hidden; background: #000; }
    #player { position: absolute; inset: 0; }
    .controls { display: flex; gap: 10px; justify-content: center; padding: 10px 0 6px; flex-wrap: wrap; }
    button {
      font: inherit; color: #111; background: var(--accent); border: 0; border-radius: 999px;
      padding: 10px 16px; font-weight: 600; cursor: pointer;
    }
    button.secondary { background: #e0e0e0; }
    .hint { text-align: center; color: var(--muted); padding: 6px 8px 14px; }
    /* Video list */
    .list { display: grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 720px) { .list { grid-template-columns: 1fr 1fr; } }
    .item {
      display: grid; grid-template-columns: 160px 1fr; gap: 12px; align-items: center;
      background: #161616; border-radius: 12px; overflow: hidden; border: 1px solid #222;
    }
    .thumb { width: 100%; height: 90px; object-fit: cover; display: block; }
    .meta { padding-right: 10px; }
    .title { font-size: 16px; font-weight: 600; line-height: 1.3; margin: 4px 0 6px; color: #fff; }
    .sub { font-size: 14px; color: var(--muted); }
    .item button {
      background: transparent; color: #fff; width: 100%; text-align: left; border-radius: 0; padding: 0; cursor: pointer;
    }
    .item button:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
    .sr { position: absolute; width: 1px; height: 1px; overflow: hidden; clip: rect(1px,1px,1px,1px); white-space: nowrap; }
  </style>
</head>
<body>
  <header>Tuttofisa – Accordion Videos</header>
  <div class="wrap">
    <div id="player-container"><div id="player"></div></div>
    <div class="controls">
      <button id="playAll">Play All (Loop)</button>
      <button id="pauseBtn" class="secondary">Pause</button>
    </div>
    <div class="hint">Tip: tap a video from the list below to play it. “Play All” loads the full uploads playlist and loops forever.</div>
    <div id="list" class="list" role="list" aria-label="Video list"></div>
  </div>

  <script>
    // ========== CONFIG (edit these) ==========
    const API_KEY = "AIzaSyAfQik4u7DXcX8jBYh9xjL34lb1UMBB-dQ"; // <-- Replace with your YouTube Data API v3 key
    const UPLOADS_PLAYLIST_ID = "UUr3JMlX82_LQiznHsDkYCgA"; // Tuttofisa uploads (derived from channel UC... -> UU...)
    const MAX_RESULTS = 50; // up to 50 items per page
    // =========================================

    // Load IFrame Player API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);

    let player;
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        playerVars: { autoplay: 0, modestbranding: 1, rel: 0, playsinline: 1 },
        events: { 'onReady': onPlayerReady }
      });
    }
    function onPlayerReady() {
      document.getElementById('pauseBtn').addEventListener('click', () => player.pauseVideo());
      document.getElementById('playAll').addEventListener('click', () => {
        player.loadPlaylist({ listType: 'playlist', list: UPLOADS_PLAYLIST_ID, index: 0 });
      });
    }

    async function fetchPlaylistItems(pageToken = "") {
      const url = new URL("https://www.googleapis.com/youtube/v3/playlistItems");
      url.searchParams.set("key", API_KEY);
      url.searchParams.set("part", "snippet,contentDetails");
      url.searchParams.set("playlistId", UPLOADS_PLAYLIST_ID);
      url.searchParams.set("maxResults", String(MAX_RESULTS));
      if (pageToken) url.searchParams.set("pageToken", pageToken);

      const res = await fetch(url);
      if (!res.ok) throw new Error("Failed to fetch playlist items");
      return res.json();
    }

    function renderItems(items) {
      const list = document.getElementById('list');
      for (const it of items) {
        const vid = it.contentDetails?.videoId;
        const sn = it.snippet || {};
        const title = sn.title || "Untitled";
        const date = sn.publishedAt ? new Date(sn.publishedAt).toLocaleDateString() : "";
        const thumb = (sn.thumbnails?.medium || sn.thumbnails?.high || sn.thumbnails?.default)?.url || "";
        const el = document.createElement('div');
        el.className = 'item';
        el.role = 'listitem';
        el.innerHTML = `
          <button aria-label="Play: ${title.replace(/"/g,'&quot;')}">
            <img class="thumb" src="${thumb}" alt="" />
          </button>
          <div class="meta">
            <div class="title">${title}</div>
            <div class="sub">${date}</div>
          </div>
        `;
        el.querySelector('button').addEventListener('click', () => {
          player.loadVideoById(vid);
          // Smooth scroll up to player on mobile
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        list.appendChild(el);
      }
    }

    async function initList() {
      try {
        let pageToken = "";
        let page = await fetchPlaylistItems(pageToken);
        renderItems(page.items || []);
        // If you want to fetch more than 50, loop here:
        // while (page.nextPageToken) {
        //   page = await fetchPlaylistItems(page.nextPageToken);
        //   renderItems(page.items || []);
        // }
      } catch (e) {
        const list = document.getElementById('list');
        list.innerHTML = '<div style="color:#f88; padding:8px;">⚠️ Could not load the video list. Please check your API key.</div>';
        console.error(e);
      }
    }

    initList();
  </script>
</body>
</html>
